---
// This page handles OAuth callbacks from providers like Apple
---

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Authenticating...</title>
  <script>
         // Handle the OAuth callback
     const handleAuthCallback = async () => {
       try {
         const { supabase } = await import('/src/lib/supabase.js');
         
         if (supabase) {
           // Handle the auth callback
           const { data, error } = await supabase.auth.getSession();
           
           // Determine the correct domain to redirect to
           const getRedirectDomain = () => {
             // If we're on localhost, redirect to production
             if (window.location.hostname === 'localhost') {
               return 'https://rugged.rugshan.dev';
             }
             // Otherwise use the current domain
             return window.location.origin;
           };
           
           const redirectDomain = getRedirectDomain();
           
           if (error) {
             console.error('Auth callback error:', error);
             window.location.href = `${redirectDomain}/?error=auth_failed`;
           } else if (data.session) {
             // Successful authentication, redirect to dashboard
             console.log('Authentication successful, redirecting to:', redirectDomain);
             window.location.href = redirectDomain;
           } else {
             // No session, redirect to login
             window.location.href = `${redirectDomain}/?error=no_session`;
           }
         } else {
           const redirectDomain = window.location.hostname === 'localhost' ? 
             'https://rugged.rugshan.dev' : window.location.origin;
           window.location.href = `${redirectDomain}/?error=service_unavailable`;
         }
       } catch (err) {
         console.error('Auth callback error:', err);
         const redirectDomain = window.location.hostname === 'localhost' ? 
           'https://rugged.rugshan.dev' : window.location.origin;
         window.location.href = `${redirectDomain}/?error=auth_failed`;
       }
     };

    // Handle the callback when the page loads
    handleAuthCallback();
  </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen flex items-center justify-center">
  <div class="text-center">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Authenticating...</h2>
    <p class="text-gray-600 dark:text-gray-400">Please wait while we complete your sign-in.</p>
  </div>
</body>
</html>
